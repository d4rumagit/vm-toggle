#!/bin/bash
# Toggle between VirtualBox and KVM
# For kvm_intel


if lsmod | grep -q kvm_intel || lsmod | grep -q kvm_amd; then
    echo "[INFO] KVM is currently enabled. Disabling it for VirtualBox..."
    sudo modprobe -r kvm_intel kvm_amd kvm 2>/dev/null
    echo "[OK] KVM disabled. VirtualBox can now run."
else
    echo "[INFO] KVM is currently disabled. Enabling it..."
    sudo modprobe kvm
    if grep -q Intel /proc/cpuinfo; then
        sudo modprobe kvm_intel
    else
        sudo modprobe kvm_amd
    fi
    echo "[OK] KVM enabled. QEMU/virt-manager can now run."
fi
